import fetch from 'node-fetch';\n\n// Uses NewsAPI.org if NEWSAPI_KEY provided; otherwise tries an RSS JSON proxy\nexport async function getNews({ query = 'general', max = 3 }) {\n  if (process.env.NEWSAPI_KEY) {\n    const url = `https://newsapi.org/v2/top-headlines?q=${encodeURIComponent(query)}&pageSize=${max}&apiKey=${process.env.NEWSAPI_KEY}`;\n    const r = await fetch(url);\n    if (!r.ok) throw new Error(`NewsAPI error: ${r.status}`);\n    const data = await r.json();\n    return {\n      source: 'newsapi',\n      articles: (data.articles || []).slice(0, max).map(a => ({\n        title: a.title, url: a.url, source: a.source?.name, description: a.description\n      }))\n    };\n  } else {\n    // Fallback: use a simple RSS-to-JSON proxy (may be rate limited)\n    const sampleRss = 'https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml';\n    const url = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(sampleRss)}`;\n    const r = await fetch(url);\n    if (!r.ok) throw new Error(`RSS proxy error: ${r.status}`);\n    const data = await r.json();\n    return {\n      source: 'rss-fallback',\n      articles: (data.items || []).slice(0, max).map(i => ({ title: i.title, url: i.link, description: i.description }))\n    };\n  }\n}\n